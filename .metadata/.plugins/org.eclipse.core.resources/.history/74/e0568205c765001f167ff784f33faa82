package com.motorPM.service;

import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.StreamSupport;

import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.motorPM.domain.dto.SigdataDTO;
import com.motorPM.persistence.MemberRepository;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class ChartService {

	private final MemberRepository mr;
	private final SigdataDTO dto;

	public List<SigdataDTO> getSigdata(Object sig) {

		ObjectMapper mapper = new ObjectMapper();
		// Object를 JsonNode로 변환
		JsonNode jsonData = mapper.convertValue(sig, JsonNode.class);

		String asset_name = jsonData.path("asset_name").asText();
		int startTime = jsonData.path("start_at").asInt();
		int endTime = jsonData.path("end_at").asInt();

		// cols 배열을 추출
        JsonNode colsNode = jsonData.path("cols");

        // cols 배열의 각 요소를 String으로 변환
        List<String> colsList = StreamSupport.stream(colsNode.spliterator(), false)
            .map(col -> col.asText()) // 각 JsonNode를 String으로 변환
            .collect(Collectors.toList());
        // 변환된 결과를 문자열로 변환
        String colsString = String.join(", ", colsList);
        
		System.out.println("\n에셋이름 : " + asset_name + "\n시작시간 : " + startTime + "\n종료시간 : "+ endTime);
		System.out.println("컬럼들 : "+colsString);
		
		
		List<Object[]> result = mr.getSigDataJoin(colsString, asset_name, startTime, endTime);
		

	}

}
